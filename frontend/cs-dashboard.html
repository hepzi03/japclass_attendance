<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Attendance Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard-switcher {
            margin-top: 20px;
        }

        .dashboard-switcher .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            margin: 0 10px;
            backdrop-filter: blur(10px);
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .dashboard-switcher .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .session-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .session-info h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .info-item strong {
            color: #667eea;
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .info-item span, .info-item small {
            color: #333;
            font-size: 1rem;
        }

        .qr-container {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .qr-container h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .qr-code {
            max-width: 200px;
            border: 3px solid #667eea;
            border-radius: 10px;
            margin: 20px 0;
        }

        .session-actions {
            margin-top: 20px;
        }

        .session-status {
            margin-top: 15px;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .session-filters {
            margin-bottom: 20px;
        }

        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .filter-toggle input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .session-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .session-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .session-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .session-status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .session-status-badge.active {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .session-status-badge.ended {
            background: #fdecea;
            color: #b71c1c;
            border: 1px solid #ffdad6;
        }

        .ended-session {
            border-left: 3px solid #ff5252;
        }

        .active-session {
            border-left: 3px solid #43a047;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        /* Fix overflow/alignment for portrait mobile */
        .session-header { flex-wrap: wrap; gap: 8px; }
        .info-grid { width: 100%; }
        .info-item { min-width: 0; }
        .info-item strong { display: block; }
        .info-item span, .info-item small { display: block; word-break: break-word; overflow-wrap: anywhere; }

        @media (max-width: 768px) {
            .card, .session-info { max-width: 100%; }
            .session-header h3 { flex: 1 1 100%; margin: 0 0 4px; }
            .info-item { padding: 12px; }
            .info-item strong { font-size: 0.95rem; line-height: 1.2; margin-bottom: 4px; }
            .info-item span, .info-item small { font-size: 0.95rem; }
            /* Group the action buttons under sessions cleanly on mobile */
            .session-info > div[style*="margin-top: 15px"],
            .session-actions { display: grid !important; grid-template-columns: 1fr; gap: 10px; }
            .session-info > div[style*="margin-top: 15px"] .btn,
            .session-actions .btn { width: 100%; }
            /* Avoid any horizontal scroll */
            body, html { overflow-x: hidden; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-qrcode"></i> CS Attendance Dashboard</h1>
            <p>Teacher Dashboard - Create and manage CS attendance sessions</p>
            <div class="dashboard-switcher">
                <a href="index.html" class="btn">
                    🏠 Back to Main Dashboard
                </a>
                <a href="japanese-dashboard.html" class="btn">
                    🇯🇵 Switch to Japanese Class Dashboard
                </a>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('create')">
                <i class="fas fa-plus"></i> Create Session
            </div>
            <div class="tab" onclick="showTab('sessions')">
                <i class="fas fa-list"></i> View Sessions
            </div>
        </div>

        <!-- Student Attendance Link -->
        <div style="text-align: center; margin: 20px 0;">
            <a href="cs-mark-attendance.html" class="btn btn-primary" style="text-decoration: none; display: inline-block; font-size: 1.1rem; padding: 15px 30px;">
                📱 CS Student Attendance Page
            </a>
            <p style="color: white; margin-top: 10px; opacity: 0.9;">
                Students can use this page to mark their attendance by scanning QR codes
            </p>
        </div>

        <!-- Create Session Tab -->
        <div id="create" class="tab-content active">
            <div class="card">
                <h2><i class="fas fa-calendar-plus"></i> Create New CS Attendance Session</h2>
                <form id="sessionForm">
                    <div class="form-group">
                        <label for="batchSelect">Select Batch:</label>
                        <select id="batchSelect" class="form-control" required>
                            <option value="">Choose a batch...</option>
                            <option value="CS2023">CS2023</option>
                            <option value="CS2024">CS2024</option>
                            <option value="CS2025">CS2025</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sessionDate">Session Date:</label>
                        <input type="date" id="sessionDate" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="timeSlot">Time Slot:</label>
                        <select id="timeSlot" class="form-control" required>
                            <option value="">Choose time slot...</option>
                            <option value="9:00-10:00">9:00-10:00</option>
                            <option value="10:00-11:00">10:00-11:00</option>
                            <option value="11:00-12:00">11:00-12:00</option>
                            <option value="12:00-13:00">12:00-13:00</option>
                            <option value="14:00-15:00">14:00-15:00</option>
                            <option value="15:00-16:00">15:00-16:00</option>
                            <option value="16:00-17:00">16:00-17:00</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="notes">Notes (Optional):</label>
                        <textarea id="notes" class="form-control" rows="3" placeholder="Add any notes for this session..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary" id="createSessionBtn">
                        <i class="fas fa-qrcode"></i> Create Session & Generate QR
                    </button>
                    <div id="locationStatus" style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        <i class="fas fa-spinner fa-spin"></i> Checking location access...
                    </div>
                    <div id="locationOverride" style="margin-top: 10px; display: none;">
                        <button type="button" class="btn btn-secondary" onclick="useDefaultLocation()" style="font-size: 0.8rem;">
                            <i class="fas fa-map-marker-alt"></i> Use Default Location
                        </button>
                        <button type="button" class="btn btn-success" onclick="handleSessionCreation()" style="font-size: 0.8rem;">
                            <i class="fas fa-play"></i> Create Session Now
                        </button>
                        <small style="display: block; margin-top: 5px; color: #666;">
                            Use this if GPS is not working
                        </small>
                    </div>
                </form>
            </div>

            <div id="sessionResult" style="display: none;">
                <div class="card">
                    <h2><i class="fas fa-check-circle"></i> Session Created Successfully!</h2>
                    <div class="session-info">
                        <h3>Session Details</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <strong>Session ID:</strong><br>
                                <span id="sessionId"></span>
                            </div>
                            <div class="info-item">
                                <strong>Batch:</strong><br>
                                <span id="batchName"></span>
                            </div>
                            <div class="info-item">
                                <strong>Date:</strong><br>
                                <span id="sessionDate"></span>
                            </div>
                            <div class="info-item">
                                <strong>Time:</strong><br>
                                <span id="sessionTime"></span>
                            </div>
                            <div class="info-item">
                                <strong>Location:</strong><br>
                                <span id="sessionLocation">Capturing location...</span>
                            </div>
                        </div>
                    </div>
                    <div class="qr-container">
                        <h3>QR Code for Students</h3>
                        <img id="qrCode" class="qr-code" alt="QR Code">
                        <p><strong>Students can scan this QR code to mark their attendance</strong></p>
                        <div class="session-actions" style="margin-top: 20px;">
                            <button id="endSessionBtn" class="btn btn-warning" onclick="endCurrentSession()">
                                <i class="fas fa-stop-circle"></i> End Session
                            </button>
                            <p class="session-status" id="sessionStatus" style="margin-top: 10px; color: #28a745;">
                                <i class="fas fa-check-circle"></i> Session is active
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Sessions Tab -->
        <div id="sessions" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-list"></i> Recent CS Sessions</h2>
                <div class="session-filters" style="margin-bottom: 20px;">
                    <label class="filter-toggle">
                        <input type="checkbox" id="showInactiveSessions" onchange="toggleInactiveSessions()">
                        Show ended sessions
                    </label>
                    <small style="color: #666; margin-left: 10px;">
                        Ended sessions are kept for record-keeping but QR codes are disabled
                    </small>
                </div>
                <div id="sessionsList" class="loading">
                    Loading sessions...
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://japclass-backend.onrender.com/api/cs';
        let currentLocation = null;
        let currentSessionId = null;

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load data for sessions tab
            if (tabName === 'sessions') {
                loadSessions();
            }
        }

        // Check location access on page load
        window.addEventListener('load', function() {
            checkLocationAccess();
        });

        function checkLocationAccess() {
            if (navigator.geolocation) {
                document.getElementById('locationStatus').innerHTML = 
                    '<i class="fas fa-map-marker-alt"></i> Location access available. Click "Create Session" to capture location.';
                document.getElementById('locationOverride').style.display = 'block';
            } else {
                document.getElementById('locationStatus').innerHTML = 
                    '<i class="fas fa-exclamation-triangle"></i> Geolocation not supported. Using default location.';
                document.getElementById('locationOverride').style.display = 'block';
            }
        }

        function useDefaultLocation() {
            // Use a default location (you can change these coordinates)
            currentLocation = {
                latitude: 13.0827,
                longitude: 80.2707,
                accuracy: 100
            };
            document.getElementById('locationStatus').innerHTML = 
                '<i class="fas fa-map-marker-alt"></i> Using default location (Chennai, India)';
            document.getElementById('locationOverride').style.display = 'none';
            
            // Enable the create session button if form is filled
            const batchSelect = document.getElementById('batchSelect');
            const sessionDate = document.getElementById('sessionDate');
            const timeSlot = document.getElementById('timeSlot');
            
            if (batchSelect.value && sessionDate.value && timeSlot.value) {
                document.getElementById('createSessionBtn').disabled = false;
            }
        }

        // Handle form submission
        document.getElementById('sessionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await handleSessionCreation();
        });

        // Handle manual session creation (for default location or when button is clicked)
        async function handleSessionCreation() {
            if (!currentLocation) {
                // Get current location first
                if (navigator.geolocation) {
                    document.getElementById('locationStatus').innerHTML = 
                        '<i class="fas fa-spinner fa-spin"></i> Getting your location...';
                    
                    try {
                        const position = await new Promise((resolve, reject) => {
                            navigator.geolocation.getCurrentPosition(resolve, reject, {
                                enableHighAccuracy: true,
                                timeout: 10000,
                                maximumAge: 0
                            });
                        });
                        
                        currentLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                        
                        document.getElementById('locationStatus').innerHTML = 
                            '<i class="fas fa-check-circle"></i> Location captured! Creating session...';
                        
                        // Now create the session with the captured location
                        await createSession();
                        
                    } catch (error) {
                        document.getElementById('locationStatus').innerHTML = 
                            '<i class="fas fa-exclamation-triangle"></i> Location error: ' + error.message;
                        document.getElementById('locationOverride').style.display = 'block';
                        alert('Failed to get location: ' + error.message + '\n\nPlease use the "Use Default Location" button instead.');
                    }
                } else {
                    alert('Geolocation not supported. Please use default location.');
                    useDefaultLocation();
                    await createSession();
                }
            } else {
                await createSession();
            }
        }

        async function createSession() {
            const batchSelect = document.getElementById('batchSelect');
            const sessionDate = document.getElementById('sessionDate');
            const timeSlot = document.getElementById('timeSlot');
            const notes = document.getElementById('notes');

            if (!batchSelect.value || !sessionDate.value || !timeSlot.value) {
                alert('Please fill in all required fields!');
                return;
            }

            // Double-check that we have valid location data
            if (!currentLocation || typeof currentLocation.latitude !== 'number' || typeof currentLocation.longitude !== 'number') {
                alert('Location data is invalid. Please capture location again or use default location.');
                currentLocation = null;
                document.getElementById('locationStatus').innerHTML = 
                    '<i class="fas fa-exclamation-triangle"></i> Location invalid. Please try again.';
                return;
            }

            const sessionData = {
                batchName: batchSelect.value,
                date: sessionDate.value,
                timeSlot: timeSlot.value,
                notes: notes.value,
                location: 'CS Class Location',
                latitude: currentLocation.latitude,
                longitude: currentLocation.longitude
            };

            try {
                document.getElementById('createSessionBtn').disabled = true;
                document.getElementById('createSessionBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';

                const response = await fetch(`${API_BASE}/sessions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(sessionData)
                });

                const result = await response.json();

                if (result.success) {
                    showSessionResult(result.data);
                    currentSessionId = result.data.sessionId;
                    // Clear form
                    document.getElementById('sessionForm').reset();
                    document.getElementById('sessionDate').value = new Date().toISOString().split('T')[0];
                    // Reset location status
                    document.getElementById('locationStatus').innerHTML = 
                        '<i class="fas fa-map-marker-alt"></i> Location access available. Click "Create Session" to capture location.';
                } else {
                    alert('Error creating session: ' + result.message);
                }
            } catch (error) {
                console.error('Session creation error:', error);
                alert('Error creating session: ' + error.message);
            } finally {
                document.getElementById('createSessionBtn').disabled = false;
                document.getElementById('createSessionBtn').innerHTML = '<i class="fas fa-qrcode"></i> Create Session & Generate QR';
            }
        }

        function showSessionResult(sessionData) {
            document.getElementById('sessionId').textContent = sessionData.sessionId;
            document.getElementById('batchName').textContent = sessionData.batchName;
            document.getElementById('sessionDate').textContent = new Date(sessionData.date).toLocaleDateString();
            document.getElementById('sessionTime').textContent = sessionData.timeSlot;
            document.getElementById('sessionLocation').textContent = `${sessionData.location} (${sessionData.coordinates.latitude.toFixed(6)}, ${sessionData.coordinates.longitude.toFixed(6)})`;
            
            if (sessionData.qrCode) {
                document.getElementById('qrCode').src = sessionData.qrCode;
            }

            document.getElementById('sessionResult').style.display = 'block';
            document.getElementById('sessionResult').scrollIntoView({ behavior: 'smooth' });
        }

        async function endCurrentSession() {
            if (!currentSessionId) {
                alert('No active session to end!');
                return;
            }

            if (!confirm('Are you sure you want to end this session? Students will no longer be able to mark attendance.')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/sessions/${currentSessionId}/end`, {
                    method: 'PUT'
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('sessionStatus').innerHTML = 
                        '<i class="fas fa-stop-circle"></i> Session ended';
                    document.getElementById('sessionStatus').style.color = '#dc3545';
                    document.getElementById('endSessionBtn').style.display = 'none';
                    alert('Session ended successfully!');
                } else {
                    alert('Error ending session: ' + result.message);
                }
            } catch (error) {
                alert('Error ending session: ' + error.message);
            }
        }

        function toggleInactiveSessions() {
            loadSessions();
        }

        async function loadSessions() {
            const sessionsList = document.getElementById('sessionsList');
            const showInactive = document.getElementById('showInactiveSessions').checked;

            sessionsList.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Loading CS sessions...
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE}/sessions?showEnded=${showInactive}`);
                const result = await response.json();

                if (result.success && result.data.length > 0) {
                    sessionsList.innerHTML = result.data.map(session => `
                        <div class="session-card ${session.isActive ? 'active-session' : 'ended-session'}">
                            <div class="session-header">
                                <h3>${session.batchName} - ${session.location}</h3>
                                <span class="session-status-badge ${session.isActive ? 'active' : 'ended'}">
                                    ${session.isActive ? 'Active' : 'Ended'}
                                </span>
                            </div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>Session ID:</strong><br>
                                    <span>${session.sessionId}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Date:</strong><br>
                                    <span>${new Date(session.date).toLocaleDateString()}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Time:</strong><br>
                                    <span>${session.timeSlot}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Students Present:</strong><br>
                                    <span>${session.attendanceCount || 0} / ${session.totalStudents || 63}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Location:</strong><br>
                                    <small>${session.coordinates.latitude.toFixed(6)}, ${session.coordinates.longitude.toFixed(6)}</small>
                                </div>
                            </div>
                            <div class="session-actions" style="margin-top: 15px;">
                                <button class="btn btn-primary" onclick="viewAttendance('${session.sessionId}')">
                                    <i class="fas fa-users"></i> View Attendance
                                </button>
                                <button class="btn btn-success" onclick="exportExcel('${session.sessionId}')">
                                    <i class="fas fa-file-excel"></i> Export Excel
                                </button>
                                ${session.isActive ? 
                                    `<button class="btn btn-warning" onclick="endSession('${session.sessionId}')">
                                        <i class="fas fa-stop-circle"></i> End Session
                                    </button>` :
                                    `<button class="btn btn-danger" onclick="deleteSession('${session.sessionId}')">
                                        <i class="fas fa-trash"></i> Delete Session
                                    </button>`
                                }
                            </div>
                        </div>
                    `).join('');
                } else {
                    sessionsList.innerHTML = `
                        <div class="alert alert-info">
                            <strong>No CS sessions found.</strong><br>
                            Create your first session using the "Create Session" tab above.
                        </div>
                    `;
                }
            } catch (error) {
                sessionsList.innerHTML = `
                    <div class="alert alert-error">
                        <strong>Error loading sessions:</strong> ${error.message}<br>
                        Please check your internet connection and try again.
                    </div>
                `;
            }
        }

        async function endSession(sessionId) {
            if (!confirm('Are you sure you want to end this session?')) return;
            
            try {
                const response = await fetch(`${API_BASE}/sessions/${sessionId}/end`, {
                    method: 'PUT'
                });
                
                if (response.ok) {
                    alert('Session ended successfully!');
                    loadSessions(); // Refresh the list
                } else {
                    alert('Error ending session');
                }
            } catch (error) {
                alert('Error ending session: ' + error.message);
            }
        }

        async function deleteSession(sessionId) {
            if (!confirm('Are you sure you want to permanently delete this session? This action cannot be undone.')) return;
            
            try {
                const response = await fetch(`${API_BASE}/sessions/${sessionId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Session deleted successfully!');
                    loadSessions(); // Refresh the list
                } else {
                    alert('Error deleting session');
                }
            } catch (error) {
                alert('Error deleting session: ' + error.message);
            }
        }

        function viewAttendance(sessionId) {
            alert(`Viewing attendance for CS session: ${sessionId}\n\nThis feature will show the attendance list for this session.`);
        }

        function exportExcel(sessionId) {
            alert(`Exporting Excel for CS session: ${sessionId}\n\nThis feature will download an Excel file with attendance data.`);
        }

        // Set today's date as default
        document.getElementById('sessionDate').value = new Date().toISOString().split('T')[0];

        // Load initial data
        loadSessions();
    </script>
</body>
</html>